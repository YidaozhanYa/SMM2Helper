<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SMM2Helper</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="button.css">
    <link rel="stylesheet" href="dialog.css">
    <link rel="stylesheet" href="message.css">
</head>
<body>
<div class="box">
    <div class="left">
        <div class="main-head" style="align-items: flex-start;">
            <h3 style="margin: 0; padding: 0">SMM2Helper</h3>
            <h3 style="margin: 0; padding: 0; font-weight: normal">&nbsp;By YidaozhanYa</h3>
        </div>
        <div class="card main-card" id="left-card">
            <ol id="local-courses">
            </ol>
        </div>
    </div>
    <div class="right">
        <div class="main-head" style="align-items: center">
            <div class="tabs" id="tabs" state="loading">
                <div id="e" class="tab tab-active" onclick="activeTab(this)">Easy</div>
                <div id="n" class="tab" onclick="activeTab(this)">Normal</div>
                <div id="ex" class="tab" onclick="activeTab(this)">Expert</div>
                <div id="sex" class="tab" onclick="activeTab(this)">Super Expert</div>
            </div>
            &nbsp;&nbsp;
            <div class="tabs">
                <button type="button"
                        class="fluent-button fluent-button-secondary"
                        onclick="switchRandom(this)"
                        title="Random: Search courses from Endless Challenge
Popular: Search courses from popular courses">
                    Random
                </button>
            </div>
        </div>
        <div class="card main-card" id="right-card">
            <ol id="online-courses"></ol>
            <div id="online-course"></div>
            <div id="online-maker"></div>
        </div>
    </div>
</div>
<div class="float" id="float">
    <div id="error-message" class="message error-message" onclick="hideErrorMessage()">
    </div>
</div>
<div class="dialog-bg" id="dialog-bg">
    <div class="dialog-box" id="dialog-box">
        <div class="dialog-title" id="dialog-title"></div>
        <div class="dialog-content" id="dialog-content"></div>
        <div class="dialog-actions">
            <button type="button" class="fluent-button fluent-button-secondary" id="dialog-button-no"></button>
            <button type="button" class="fluent-button fluent-button-primary" id="dialog-button-yes"></button>
        </div>
    </div>
</div>
<script language="javascript">
    function finishResponse(response) {
        console.log('jsbridge response:' + response.message)
    }

    function GenerateCourseEntry(course_title, course_desc, course_idx) {
        const entry = document.createElement('li');
        entry.setAttribute('class', 'entry');
        entry.setAttribute('onclick', 'activeEntry(this)');
        const courseTitle = document.createElement('div');
        courseTitle.setAttribute('class', 'course-title text-limited');
        courseTitle.innerText = course_title;
        const courseDesc = document.createElement('div');
        courseDesc.setAttribute('class', 'course-desc text-limited');
        courseDesc.innerText = course_desc;
        const entryContent = document.createElement('div');
        entryContent.setAttribute('class', 'entry-content');
        entryContent.appendChild(courseTitle);
        entryContent.appendChild(courseDesc);
        entry.setAttribute('idx', course_idx);
        entry.appendChild(entryContent);
        return entry;
    }

    function insertMyCourse(course_title, course_desc, course_idx) {
        const entry = GenerateCourseEntry(course_title, course_desc, course_idx);
        document.getElementById('local-courses').appendChild(entry);
    }

    function insertOnlineCourse(course_title, course_desc, course_idx) {
        const entry = GenerateCourseEntry(course_title, course_desc, course_idx);
        document.getElementById('online-courses').appendChild(entry);
    }

    function activeEntry(obj) {
        Array.from(
            document.getElementsByClassName('entry')
        ).forEach(
            function (element) {
                element.setAttribute('class', 'entry');
            }
        )
        obj.setAttribute('class', 'entry entry-active');
    }

    function activeTab(obj) {
        const tabs = document.getElementById('tabs');
        if (tabs.getAttribute('state') === 'loading') {
            return;
        }
        tabs.setAttribute('state', 'loading');
        Array.from(
            document.getElementsByClassName('tab')
        ).forEach(
            function (element) {
                element.setAttribute('class', 'tab');
            }
        )
        obj.setAttribute('class', 'tab tab-active');
        pywebview.api.handle_tab_active(obj.id).then(() => tabs.removeAttribute('state'), (err) => showErrorMessage(err))
    }

    function showErrorMessage(message) {
        console.error(message);
        const float = document.getElementById('float')
        const errorMessage = document.getElementById('error-message')
        float.style.visibility = 'visible';
        errorMessage.innerText = message;
        errorMessage.style.opacity = '1';
        errorMessage.style.transform = 'scaleY(1)';
        setTimeout(hideErrorMessage, 3000)
    }

    function hideErrorMessage() {
        const float = document.getElementById('float')
        const errorMessage = document.getElementById('error-message')
        float.style.visibility = 'hidden';
        errorMessage.style.opacity = '0';
        errorMessage.style.transform = 'scaleY(0)';
    }

    function clearOnlineCourse() {
        document.getElementById('online-courses').innerHTML = '';
    }

    function switchRandom(obj) {
        pywebview.api.handle_switch_random().then(
            (is_random) => {
                obj.innerText = is_random ? 'Random' : 'Popular';
                activeTab(document.getElementsByClassName('tab-active')[0]);
            }
        );
    }

    function showDialog(title, content, yes_visible, yes_text, no_visible, no_text, dialog_callback_id) {
        document.getElementById('dialog-bg').style.visibility = 'visible';
        document.getElementById('dialog-box').style.opacity = 1;
        document.getElementById('dialog-title').innerText = title;
        document.getElementById('dialog-content').innerText = content;
        const button_yes = document.getElementById('dialog-button-yes');
        button_yes.setAttribute('callback-id', dialog_callback_id);
        const button_no = document.getElementById('dialog-button-no');
        button_no.setAttribute('callback-id', dialog_callback_id);
        if (yes_visible) {
            button_yes.style.visibility = 'visible';
            button_yes.innerText = yes_text;
        } else {
            button_yes.style.visibility = 'hidden';
        }
        if (no_visible) {
            button_no.style.visibility = 'visible';
            button_no.innerText = no_text;
        } else {
            button_no.style.visibility = 'hidden';
        }
    }
</script>
</body>
</html>